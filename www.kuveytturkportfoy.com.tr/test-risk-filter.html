<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Portfolio Optimizer - Risk Filtresi Testi</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #eee; }
        .test-section { background: #16213e; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .success { color: #00ff88; font-weight: bold; }
        .error { color: #ff4444; font-weight: bold; }
        .fund-item { padding: 8px; margin: 5px 0; background: #0f3460; border-radius: 5px; }
        .risk-high { border-left: 4px solid #ff4444; }
        .risk-medium { border-left: 4px solid #ffaa00; }
        .risk-low { border-left: 4px solid #00ff88; }
        h1 { color: #e94560; }
        h2 { color: #0f4c75; background: #eee; padding: 10px; border-radius: 5px; }
        pre { background: #0a0a1a; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Portfolio Optimizer - Risk Filtresi Testi</h1>
    <div id="results"></div>

    <script src="/Content/js/fund-data.js"></script>
    <script src="/Content/js/portfolio-optimizer.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function log(html) {
            results.innerHTML += html;
        }
        
        function getRiskClass(level) {
            if (level <= 2) return 'risk-low';
            if (level <= 4) return 'risk-medium';
            return 'risk-high';
        }

        try {
            // Initialize
            log('<div class="test-section">');
            log('<h2>ğŸ“Š BaÅŸlatma</h2>');
            
            const optimizer = new PortfolioOptimizer(FUND_DATA_CSV);
            log(`<p>âœ… Optimizer baÅŸlatÄ±ldÄ±. Toplam fon: <strong>${optimizer.funds.length}</strong></p>`);
            
            // Show all funds with risk levels
            log('<h3>TÃ¼m FonlarÄ±n Risk Seviyeleri:</h3>');
            log('<div style="max-height: 200px; overflow-y: auto;">');
            optimizer.funds.forEach(f => {
                log(`<div class="fund-item ${getRiskClass(f.category.riskLevel)}">${f.code}: ${f.category.typeName} - Risk: ${f.category.riskLevel}/7</div>`);
            });
            log('</div></div>');

            // ========== TEST 1: LOW RISK ==========
            log('<div class="test-section">');
            log('<h2>ğŸ§ª TEST 1: DÃ¼ÅŸÃ¼k Riskli YatÄ±rÄ±mcÄ± (low)</h2>');
            
            const lowRiskAnswers = {
                q1: 'd', q2: 'a', q3: 'a', q4: 'a', q5: 'a',
                q6: 'a', q7: 'a', q8: 'a', q9: 'a', q10: 'a', q11: 'a', q12: 'a'
            };
            
            const lowRiskResult = optimizer.calculateRiskScore(lowRiskAnswers);
            log(`<p>Risk Profili: <strong>${lowRiskResult.profile}</strong></p>`);
            log(`<p>Risk Skoru: <strong>${lowRiskResult.score}/100</strong></p>`);
            
            const lowPortfolio = optimizer.generateOptimalPortfolio(lowRiskResult);
            
            if (lowPortfolio && lowPortfolio.funds && lowPortfolio.funds.length > 0) {
                log('<h3>Ã–nerilen PortfÃ¶y:</h3>');
                lowPortfolio.funds.forEach(f => {
                    log(`<div class="fund-item ${getRiskClass(f.category.riskLevel)}">${f.code}: ${f.category.typeName} - Risk: ${f.category.riskLevel}/7 - AÄŸÄ±rlÄ±k: ${f.allocation.toFixed(2)}%</div>`);
                });
                
                // Check for violations
                const highRiskFunds = lowPortfolio.funds.filter(f => f.category.riskLevel > 3);
                if (highRiskFunds.length > 0) {
                    log('<p class="error">âŒ HATA: DÃ¼ÅŸÃ¼k riskli yatÄ±rÄ±mcÄ±ya yÃ¼ksek riskli fon Ã¶nerildi!</p>');
                    highRiskFunds.forEach(f => {
                        log(`<p class="error">   â†’ ${f.code}: Risk ${f.category.riskLevel}/7</p>`);
                    });
                } else {
                    log('<p class="success">âœ… BAÅARILI: TÃ¼m fonlar risk seviyesi â‰¤3</p>');
                }
            } else {
                log('<p class="error">âŒ PortfÃ¶y oluÅŸturulamadÄ±!</p>');
                log('<pre>' + JSON.stringify(lowPortfolio, null, 2) + '</pre>');
            }
            log('</div>');

            // ========== TEST 2: MEDIUM RISK ==========
            log('<div class="test-section">');
            log('<h2>ğŸ§ª TEST 2: Orta Riskli YatÄ±rÄ±mcÄ± (medium)</h2>');
            
            const mediumRiskAnswers = {
                q1: 'b', q2: 'b', q3: 'b', q4: 'b', q5: 'b',
                q6: 'b', q7: 'b', q8: 'b', q9: 'b', q10: 'b', q11: 'b', q12: 'b'
            };
            
            const mediumRiskResult = optimizer.calculateRiskScore(mediumRiskAnswers);
            log(`<p>Risk Profili: <strong>${mediumRiskResult.profile}</strong></p>`);
            log(`<p>Risk Skoru: <strong>${mediumRiskResult.score}/100</strong></p>`);
            
            const mediumPortfolio = optimizer.generateOptimalPortfolio(mediumRiskResult);
            
            if (mediumPortfolio && mediumPortfolio.funds && mediumPortfolio.funds.length > 0) {
                log('<h3>Ã–nerilen PortfÃ¶y:</h3>');
                mediumPortfolio.funds.forEach(f => {
                    log(`<div class="fund-item ${getRiskClass(f.category.riskLevel)}">${f.code}: ${f.category.typeName} - Risk: ${f.category.riskLevel}/7 - AÄŸÄ±rlÄ±k: ${f.allocation.toFixed(2)}%</div>`);
                });
                
                const tooHighRiskFunds = mediumPortfolio.funds.filter(f => f.category.riskLevel > 5);
                if (tooHighRiskFunds.length > 0) {
                    log('<p class="error">âŒ HATA: Orta riskli yatÄ±rÄ±mcÄ±ya Ã§ok yÃ¼ksek riskli fon Ã¶nerildi!</p>');
                } else {
                    log('<p class="success">âœ… BAÅARILI: TÃ¼m fonlar risk seviyesi â‰¤5</p>');
                }
            } else {
                log('<p class="error">âŒ PortfÃ¶y oluÅŸturulamadÄ±!</p>');
            }
            log('</div>');

            // ========== TEST 3: HIGH RISK ==========
            log('<div class="test-section">');
            log('<h2>ğŸ§ª TEST 3: YÃ¼ksek Riskli YatÄ±rÄ±mcÄ± (high)</h2>');
            
            const highRiskAnswers = {
                q1: 'a', q2: 'd', q3: 'd', q4: 'd', q5: 'c',
                q6: 'c', q7: 'c', q8: 'c', q9: 'c', q10: 'c', q11: 'c', q12: 'c'
            };
            
            const highRiskResult = optimizer.calculateRiskScore(highRiskAnswers);
            log(`<p>Risk Profili: <strong>${highRiskResult.profile}</strong></p>`);
            log(`<p>Risk Skoru: <strong>${highRiskResult.score}/100</strong></p>`);
            
            const highPortfolio = optimizer.generateOptimalPortfolio(highRiskResult);
            
            if (highPortfolio && highPortfolio.funds && highPortfolio.funds.length > 0) {
                log('<h3>Ã–nerilen PortfÃ¶y:</h3>');
                highPortfolio.funds.forEach(f => {
                    log(`<div class="fund-item ${getRiskClass(f.category.riskLevel)}">${f.code}: ${f.category.typeName} - Risk: ${f.category.riskLevel}/7 - AÄŸÄ±rlÄ±k: ${f.allocation.toFixed(2)}%</div>`);
                });
                log('<p class="success">âœ… YÃ¼ksek riskli yatÄ±rÄ±mcÄ± iÃ§in tÃ¼m risk seviyeleri kabul edilir</p>');
            } else {
                log('<p class="error">âŒ PortfÃ¶y oluÅŸturulamadÄ±!</p>');
            }
            log('</div>');

            // Summary
            log('<div class="test-section">');
            log('<h2>ğŸ“‹ Test Ã–zeti</h2>');
            log('<p>Beklenen DavranÄ±ÅŸ:</p>');
            log('<ul>');
            log('<li><strong>DÃ¼ÅŸÃ¼k Risk (low):</strong> Sadece risk seviyesi 1-3 fonlar Ã¶nerilmeli</li>');
            log('<li><strong>Orta Risk (medium):</strong> Risk seviyesi 1-5 fonlar Ã¶nerilmeli</li>');
            log('<li><strong>YÃ¼ksek Risk (high):</strong> TÃ¼m fonlar (1-7) Ã¶nerilebilir</li>');
            log('</ul>');
            log('</div>');

        } catch (error) {
            log('<div class="test-section">');
            log('<p class="error">âŒ HATA: ' + error.message + '</p>');
            log('<pre>' + error.stack + '</pre>');
            log('</div>');
        }
    </script>
</body>
</html>

